{"title":"UE5腾讯AI绘画插件","uid":"736b8df2107eb9f197fd84b43d0b54f0","slug":"7_18_UE5腾讯AI绘画插件","date":"2024-02-29T06:19:33.429Z","updated":"2024-02-29T06:18:20.288Z","comments":true,"path":"api/articles/7_18_UE5腾讯AI绘画插件.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/FHangH/FHangBlogCDN_03@master/Aurora_ (40).webp","content":"<h1 id=\"UE5腾讯AI绘画插件\"><a href=\"#UE5腾讯AI绘画插件\" class=\"headerlink\" title=\"UE5腾讯AI绘画插件\"></a>UE5腾讯AI绘画插件</h1><p>[toc]</p>\n<h3 id=\"0-github\"><a href=\"#0-github\" class=\"headerlink\" title=\"0. github\"></a>0. github</h3><p><a href=\"https://github.com/FHangH/TencentAIArt\">UE5腾讯AI绘画插件</a></p>\n<h3 id=\"1-腾讯HTTP-V3验证\"><a href=\"#1-腾讯HTTP-V3验证\" class=\"headerlink\" title=\"1. 腾讯HTTP V3验证\"></a>1. 腾讯HTTP V3验证</h3><p><code>TencentAIArtV3.h</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> once</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;TencentAIArtConfig.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">DECLARE_LOG_CATEGORY_EXTERN</span>(LogTencentAIArt, Log, All);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"title\">DEFINE_LOG_CATEGORY</span><span class=\"params\">(LogTencentAIArt)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TencentAIArtV3</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">TencentAIArtV3</span>() = <span class=\"keyword\">default</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring SECRET_ID;</span><br><span class=\"line\">    string SECRET_KEY;</span><br><span class=\"line\">    string service;</span><br><span class=\"line\">    string host;</span><br><span class=\"line\">    string region;</span><br><span class=\"line\">    string action;</span><br><span class=\"line\">    string version;</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring payload;</span><br><span class=\"line\">    <span class=\"type\">int64_t</span> timestamp;</span><br><span class=\"line\">    string date;</span><br><span class=\"line\"></span><br><span class=\"line\">    string hashedRequestPayload;</span><br><span class=\"line\">    string httpRequestMethod;</span><br><span class=\"line\">    string canonicalUri;</span><br><span class=\"line\">    string canonicalQueryString;</span><br><span class=\"line\">    string lower;</span><br><span class=\"line\">    string canonicalHeaders;</span><br><span class=\"line\">    string signedHeaders;</span><br><span class=\"line\">    string canonicalRequest;</span><br><span class=\"line\"></span><br><span class=\"line\">    string algorithm;</span><br><span class=\"line\">    string RequestTimestamp;</span><br><span class=\"line\">    string credentialScope;</span><br><span class=\"line\">    string hashedCanonicalRequest;</span><br><span class=\"line\">    string stringToSign;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    string kKey;</span><br><span class=\"line\">    string kDate;</span><br><span class=\"line\">    string kService;</span><br><span class=\"line\">    string kSigning;</span><br><span class=\"line\">    string signature;</span><br><span class=\"line\">    string authorization;</span><br><span class=\"line\"></span><br><span class=\"line\">\tEReqImgType ReqImageType;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">static</span> TencentAIArtV3&amp; <span class=\"title\">Get</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">static</span> TencentAIArtV3 TAAV3;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TAAV3;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">initConfig</span><span class=\"params\">(<span class=\"type\">const</span> FTencentAIArtConfig&amp; AIArtConfig)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">initTTI_Or_ITI</span><span class=\"params\">(<span class=\"type\">const</span> FPromptTTIConfig&amp; PromptTTIConfig)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">getReqImageType</span><span class=\"params\">(EReqImgType&amp; ReqImgType)</span> <span class=\"type\">const</span></span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">get_data</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">int64_t</span> &amp;timestamp)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">int2str</span><span class=\"params\">(<span class=\"type\">int64_t</span> n)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">sha256Hex</span><span class=\"params\">(<span class=\"type\">const</span> string &amp;str)</span></span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">HmacSha256</span><span class=\"params\">(<span class=\"type\">const</span> string &amp;key, <span class=\"type\">const</span> string &amp;input)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">HexEncode</span><span class=\"params\">(<span class=\"type\">const</span> string &amp;input)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">GetPayload</span><span class=\"params\">()</span> </span>&#123;<span class=\"keyword\">return</span> payload;&#125;</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">Gettimestamp</span><span class=\"params\">()</span> </span>&#123;<span class=\"keyword\">return</span> <span class=\"built_in\">int2str</span>(timestamp);&#125;</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">GetHost</span><span class=\"params\">()</span> </span>&#123;<span class=\"keyword\">return</span> host;&#125;</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">GetAction</span><span class=\"params\">()</span> </span>&#123;<span class=\"keyword\">return</span> action;&#125;</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">GetVersion</span><span class=\"params\">()</span> </span>&#123;<span class=\"keyword\">return</span> version;&#125;</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">GetRegion</span><span class=\"params\">()</span> </span>&#123;<span class=\"keyword\">return</span> region;&#125;</span><br><span class=\"line\">\t<span class=\"function\">string <span class=\"title\">GetAuthorization</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><code>TencentAIArtV3.cpp</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;TencentAIArtV3.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iomanip&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;sstream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;time.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> UI UI_ST</span></span><br><span class=\"line\">THIRD_PARTY_INCLUDES_START</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;openssl/sha.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;openssl/hmac.h&quot;</span></span></span><br><span class=\"line\">THIRD_PARTY_INCLUDES_END</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">undef</span> UI</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TencentAIArtV3::initConfig</span><span class=\"params\">(<span class=\"type\">const</span> FTencentAIArtConfig&amp; AIArtConfig)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tSECRET_ID = <span class=\"built_in\">TCHAR_TO_UTF8</span>(*AIArtConfig.Secret_ID);</span><br><span class=\"line\">\tSECRET_KEY =  <span class=\"built_in\">TCHAR_TO_UTF8</span>(*AIArtConfig.Secret_Key);</span><br><span class=\"line\">\tservice =  <span class=\"built_in\">TCHAR_TO_UTF8</span>(*AIArtConfig.Service);</span><br><span class=\"line\">\thost =  <span class=\"built_in\">TCHAR_TO_UTF8</span>(*UTencentConfig::<span class=\"built_in\">ConvStr_EHost</span>(AIArtConfig.Host));</span><br><span class=\"line\">\tregion =  <span class=\"built_in\">TCHAR_TO_UTF8</span>(*UTencentConfig::<span class=\"built_in\">ConvStr_Region</span>(AIArtConfig.Region));</span><br><span class=\"line\">\taction =  <span class=\"built_in\">TCHAR_TO_UTF8</span>(*UTencentConfig::<span class=\"built_in\">ConvStr_EAction</span>(AIArtConfig.Action));</span><br><span class=\"line\">\tversion =  <span class=\"built_in\">TCHAR_TO_UTF8</span>(*AIArtConfig.Version);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TencentAIArtV3::initTTI_Or_ITI</span><span class=\"params\">(<span class=\"type\">const</span> FPromptTTIConfig&amp; PromptTTIConfig)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">const</span> FString TTI_Prompt = PromptTTIConfig.Prompt;</span><br><span class=\"line\">\t<span class=\"type\">const</span> FString TTI_Styles = UTencentConfig::<span class=\"built_in\">ConvStr_EStylesTTI</span>(PromptTTIConfig.Styles);</span><br><span class=\"line\">\t<span class=\"type\">const</span> FString TTI_Resolution = UTencentConfig::<span class=\"built_in\">ConvStr_EResolution</span>(PromptTTIConfig.Resolution);</span><br><span class=\"line\">\t<span class=\"type\">const</span> <span class=\"type\">int</span> TTI_LogoAdd = UTencentConfig::<span class=\"built_in\">ConvStr_ELogoAdd</span>(PromptTTIConfig.LogoAdd);</span><br><span class=\"line\">\tReqImageType = PromptTTIConfig.ReqImgType;</span><br><span class=\"line\">\t<span class=\"type\">const</span> FString TTI_ReqImgType = UTencentConfig::<span class=\"built_in\">ConvStr_ERspImgType</span>(ReqImageType);</span><br><span class=\"line\">\t<span class=\"type\">const</span> FString Text =</span><br><span class=\"line\">\t\tFString::<span class=\"built_in\">Printf</span>(</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;&#123;\\&quot;Prompt\\&quot;:\\&quot;%s\\&quot;,\\&quot;Styles\\&quot;:[\\&quot;%s\\&quot;],\\&quot;ResultConfig\\&quot;:&#123;\\&quot;Resolution\\&quot;:\\&quot;%s\\&quot;&#125;,\\&quot;LogoAdd\\&quot;:%d,\\&quot;RspImgType\\&quot;:\\&quot;%s\\&quot;&#125;&quot;</span>),</span><br><span class=\"line\">\t\t\t*TTI_Prompt, *TTI_Styles, *TTI_Resolution, TTI_LogoAdd, *TTI_ReqImgType);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tpayload = <span class=\"built_in\">string</span>(<span class=\"built_in\">TCHAR_TO_UTF8</span>(*Text));</span><br><span class=\"line\">\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;payload = %s&quot;</span>), *<span class=\"built_in\">FString</span>(<span class=\"built_in\">UTF8_TO_TCHAR</span>(payload.<span class=\"built_in\">c_str</span>())));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TencentAIArtV3::getReqImageType</span><span class=\"params\">(EReqImgType&amp; ReqImgType)</span> <span class=\"type\">const</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tReqImgType = ReqImageType;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">string <span class=\"title\">TencentAIArtV3::get_data</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">int64_t</span>&amp; Timestamp)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">char</span> buff[<span class=\"number\">20</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">\ttm sttime;</span><br><span class=\"line\">\t<span class=\"built_in\">gmtime_s</span>(&amp;sttime, &amp;Timestamp);</span><br><span class=\"line\">\t<span class=\"built_in\">strftime</span>(buff, <span class=\"built_in\">sizeof</span>(buff), <span class=\"string\">&quot;%Y-%m-%d&quot;</span>, &amp;sttime);</span><br><span class=\"line\">\tstring utcDate = <span class=\"built_in\">string</span>(buff);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> utcDate;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">string <span class=\"title\">TencentAIArtV3::int2str</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">int64_t</span> n)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tstd::stringstream ss;</span><br><span class=\"line\">\tss &lt;&lt; n;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ss.<span class=\"built_in\">str</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">string <span class=\"title\">TencentAIArtV3::sha256Hex</span><span class=\"params\">(<span class=\"type\">const</span> string&amp; str)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">unsigned</span> <span class=\"type\">char</span> hash[SHA256_DIGEST_LENGTH];</span><br><span class=\"line\">\tSHA256_CTX sha256;</span><br><span class=\"line\">\t<span class=\"built_in\">SHA256_Init</span>(&amp;sha256);</span><br><span class=\"line\">\t<span class=\"built_in\">SHA256_Update</span>(&amp;sha256, str.<span class=\"built_in\">c_str</span>(), str.<span class=\"built_in\">size</span>());</span><br><span class=\"line\">\t<span class=\"built_in\">SHA256_Final</span>(hash, &amp;sha256);</span><br><span class=\"line\">\tstd::string NewString = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; SHA256_DIGEST_LENGTH; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">char</span> buf[<span class=\"number\">3</span>];</span><br><span class=\"line\">\t\t<span class=\"built_in\">snprintf</span>(buf, <span class=\"built_in\">sizeof</span>(buf), <span class=\"string\">&quot;%02x&quot;</span>, hash[i]);</span><br><span class=\"line\">\t\tNewString = NewString + buf;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> NewString;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">string <span class=\"title\">TencentAIArtV3::HmacSha256</span><span class=\"params\">(<span class=\"type\">const</span> string&amp; key, <span class=\"type\">const</span> string&amp; input)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">unsigned</span> <span class=\"type\">char</span> hash[<span class=\"number\">32</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">\tHMAC_CTX *h;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> OPENSSL_VERSION_NUMBER &lt; 0x10100000L</span></span><br><span class=\"line\">\tHMAC_CTX hmac;</span><br><span class=\"line\">\t<span class=\"built_in\">HMAC_CTX_init</span>(&amp;hmac);</span><br><span class=\"line\">\th = &amp;hmac;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">else</span></span></span><br><span class=\"line\">\th = <span class=\"built_in\">HMAC_CTX_new</span>();</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">HMAC_Init_ex</span>(h, &amp;key[<span class=\"number\">0</span>], key.<span class=\"built_in\">length</span>(), <span class=\"built_in\">EVP_sha256</span>(), <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">HMAC_Update</span>(h, ( <span class=\"type\">unsigned</span> <span class=\"type\">char</span>* )&amp;input[<span class=\"number\">0</span>], input.<span class=\"built_in\">length</span>());</span><br><span class=\"line\">\t<span class=\"type\">unsigned</span> <span class=\"type\">int</span> len = <span class=\"number\">32</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">HMAC_Final</span>(h, hash, &amp;len);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> OPENSSL_VERSION_NUMBER &lt; 0x10100000L</span></span><br><span class=\"line\">\t<span class=\"built_in\">HMAC_CTX_cleanup</span>(h);</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">else</span></span></span><br><span class=\"line\">\t<span class=\"built_in\">HMAC_CTX_free</span>(h);</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\tstd::stringstream ss;</span><br><span class=\"line\">\tss &lt;&lt; std::<span class=\"built_in\">setfill</span>(<span class=\"string\">&#x27;0&#x27;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">unsigned</span> <span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; len; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tss  &lt;&lt; hash[i];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> (ss.<span class=\"built_in\">str</span>());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">string <span class=\"title\">TencentAIArtV3::HexEncode</span><span class=\"params\">(<span class=\"type\">const</span> string&amp; input)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">const</span> <span class=\"type\">size_t</span> len = input.<span class=\"built_in\">length</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring output;</span><br><span class=\"line\">\toutput.<span class=\"built_in\">reserve</span>(<span class=\"number\">2</span> * len);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; len; ++i)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">static</span> <span class=\"type\">const</span> <span class=\"type\">char</span>* <span class=\"type\">const</span> lut = <span class=\"string\">&quot;0123456789abcdef&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"type\">const</span> <span class=\"type\">unsigned</span> <span class=\"type\">char</span> c = input[i];</span><br><span class=\"line\">\t\toutput.<span class=\"built_in\">push_back</span>(lut[c &gt;&gt; <span class=\"number\">4</span>]);</span><br><span class=\"line\">\t\toutput.<span class=\"built_in\">push_back</span>(lut[c &amp; <span class=\"number\">15</span>]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> output;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">string <span class=\"title\">TencentAIArtV3::GetAuthorization</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\ttimestamp = FDateTime::<span class=\"built_in\">UtcNow</span>().<span class=\"built_in\">ToUnixTimestamp</span>();</span><br><span class=\"line\">\tdate = <span class=\"built_in\">get_data</span>(timestamp);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// ************* 步骤 1：拼接规范请求串 *************</span></span><br><span class=\"line\">\thashedRequestPayload = <span class=\"built_in\">sha256Hex</span>(payload);</span><br><span class=\"line\">\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;hashedRequestPayload = %s&quot;</span>), *<span class=\"built_in\">FString</span>(hashedRequestPayload.<span class=\"built_in\">c_str</span>()))</span><br><span class=\"line\"></span><br><span class=\"line\">\thttpRequestMethod = <span class=\"string\">&quot;POST&quot;</span>;</span><br><span class=\"line\">\tcanonicalUri = <span class=\"string\">&quot;/&quot;</span>;</span><br><span class=\"line\">\tcanonicalQueryString = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">\tlower = action;</span><br><span class=\"line\">\tstd::<span class=\"built_in\">transform</span>(action.<span class=\"built_in\">begin</span>(), action.<span class=\"built_in\">end</span>(), lower.<span class=\"built_in\">begin</span>(), ::tolower);</span><br><span class=\"line\">\tcanonicalHeaders = <span class=\"built_in\">string</span>(<span class=\"string\">&quot;content-type:application/json\\n&quot;</span>)</span><br><span class=\"line\">\t\t\t+ <span class=\"string\">&quot;host:&quot;</span> + host + <span class=\"string\">&quot;\\n&quot;</span></span><br><span class=\"line\">\t\t\t+ <span class=\"string\">&quot;x-tc-action:&quot;</span> + lower + <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\tsignedHeaders = <span class=\"string\">&quot;content-type;host;x-tc-action&quot;</span>;</span><br><span class=\"line\">\tcanonicalRequest = httpRequestMethod + <span class=\"string\">&quot;\\n&quot;</span></span><br><span class=\"line\">\t\t\t+ canonicalUri + <span class=\"string\">&quot;\\n&quot;</span></span><br><span class=\"line\">\t\t\t+ canonicalQueryString + <span class=\"string\">&quot;\\n&quot;</span></span><br><span class=\"line\">\t\t\t+ canonicalHeaders + <span class=\"string\">&quot;\\n&quot;</span></span><br><span class=\"line\">\t\t\t+ signedHeaders + <span class=\"string\">&quot;\\n&quot;</span></span><br><span class=\"line\">\t\t\t+ hashedRequestPayload;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;canonicalRequest = %s&quot;</span>), *<span class=\"built_in\">FString</span>(canonicalRequest.<span class=\"built_in\">c_str</span>()))</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// ************* 步骤 2：拼接待签名字符串 *************</span></span><br><span class=\"line\">\talgorithm = <span class=\"string\">&quot;TC3-HMAC-SHA256&quot;</span>;</span><br><span class=\"line\">\tRequestTimestamp = <span class=\"built_in\">int2str</span>(timestamp);</span><br><span class=\"line\">\tcredentialScope = date + <span class=\"string\">&quot;/&quot;</span> + service + <span class=\"string\">&quot;/&quot;</span> + <span class=\"string\">&quot;tc3_request&quot;</span>;</span><br><span class=\"line\">\thashedCanonicalRequest = <span class=\"built_in\">sha256Hex</span>(canonicalRequest);</span><br><span class=\"line\">\tstringToSign = algorithm + <span class=\"string\">&quot;\\n&quot;</span> + RequestTimestamp + <span class=\"string\">&quot;\\n&quot;</span> + credentialScope + <span class=\"string\">&quot;\\n&quot;</span> + hashedCanonicalRequest;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;stringToSign = %s&quot;</span>), *<span class=\"built_in\">FString</span>(stringToSign.<span class=\"built_in\">c_str</span>()))</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// ************* 步骤 3：计算签名 ***************</span></span><br><span class=\"line\">\tkKey = <span class=\"string\">&quot;TC3&quot;</span> + SECRET_KEY;</span><br><span class=\"line\">\tkDate = <span class=\"built_in\">HmacSha256</span>(kKey, date);</span><br><span class=\"line\">\tkService = <span class=\"built_in\">HmacSha256</span>(kDate, service);</span><br><span class=\"line\">\tkSigning = <span class=\"built_in\">HmacSha256</span>(kService, <span class=\"string\">&quot;tc3_request&quot;</span>);</span><br><span class=\"line\">\tsignature = <span class=\"built_in\">HexEncode</span>(<span class=\"built_in\">HmacSha256</span>(kSigning, stringToSign));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// ************* 步骤 4：拼接 Authorization *************</span></span><br><span class=\"line\">\tauthorization = algorithm + <span class=\"string\">&quot; &quot;</span> + <span class=\"string\">&quot;Credential=&quot;</span> + SECRET_ID + <span class=\"string\">&quot;/&quot;</span> + credentialScope + <span class=\"string\">&quot;, &quot;</span></span><br><span class=\"line\">\t\t\t+ <span class=\"string\">&quot;SignedHeaders=&quot;</span> + signedHeaders + <span class=\"string\">&quot;, &quot;</span> + <span class=\"string\">&quot;Signature=&quot;</span> + signature;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;authorization = %s&quot;</span>), *<span class=\"built_in\">FString</span>(authorization.<span class=\"built_in\">c_str</span>()))</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> authorization;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2. API\"></a>2. API</h3><p><code>TencentAiArt.h</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> once</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;CoreMinimal.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;TencentAIArtConfig.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;Interfaces/IHttpRequest.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;Kismet/BlueprintAsyncActionBase.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;TencentAiArt.generated.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(FResponseDelegate, FString, Result);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">UCLASS</span>(Blueprintable)</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">FH_TENCENTAIART_API</span> UTencentAiArt : <span class=\"keyword\">public</span> UBlueprintAsyncActionBase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">GENERATED_BODY</span>()</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">UPROPERTY</span>(BlueprintAssignable)</span><br><span class=\"line\">\tFResponseDelegate OnCompleted;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"built_in\">UPROPERTY</span>(BlueprintAssignable)</span><br><span class=\"line\">\tFResponseDelegate OnFail;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UFUNCTION</span>(BlueprintCallable, Category=<span class=\"string\">&quot;FH|Tencent|AI Art&quot;</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">static</span> <span class=\"type\">void</span> <span class=\"title\">InitConfig</span><span class=\"params\">(<span class=\"type\">const</span> FTencentAIArtConfig&amp; AIArtConfig)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UFUNCTION</span>(BlueprintCallable, Category=<span class=\"string\">&quot;FH|Tencent|AI Art&quot;</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">static</span> <span class=\"type\">void</span> <span class=\"title\">InitTTI_Or_ITI</span><span class=\"params\">(<span class=\"type\">const</span> FPromptTTIConfig&amp; PromptTTIConfig)</span></span>;</span><br><span class=\"line\">\t<span class=\"comment\">//void InitITI()&#123;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UFUNCTION</span>(BlueprintCallable, Category=<span class=\"string\">&quot;FH|Tencent|AI Art&quot;</span>, meta=(BlueprintInternalUseOnly=<span class=\"string\">&quot;true&quot;</span>, WorldContext = </span><br><span class=\"line\">                                                                     <span class=\"string\">&quot;WorldContextObject&quot;</span>))</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">static</span> UTencentAiArt* <span class=\"title\">ResultImageByRequest</span><span class=\"params\">(UObject* WorldContextObject)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UFUNCTION</span>(BlueprintPure, Category=<span class=\"string\">&quot;FH|Tencent|AI Art&quot;</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">static</span> UTexture2D* <span class=\"title\">Base64ToTexture2D</span><span class=\"params\">(<span class=\"type\">const</span> FString&amp; Base64Str)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">UFUNCTION</span>(BlueprintPure, Category=<span class=\"string\">&quot;FH|Tencent|AI Art&quot;</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">static</span> <span class=\"type\">void</span> <span class=\"title\">GetRequestImageType</span><span class=\"params\">(EReqImgType&amp; ReqImgType)</span></span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"built_in\">UFUNCTION</span>(BlueprintCallable, Category=<span class=\"string\">&quot;FH|Tencent|AI Art&quot;</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">static</span> <span class=\"type\">void</span> <span class=\"title\">CancelRequestImage</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">inline</span> <span class=\"type\">static</span> UTencentAiArt* AIArtHandler = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">\tTSharedPtr&lt;IHttpRequest, ESPMode::ThreadSafe&gt; HttpRequestImage<span class=\"comment\">/* = FHttpModule::Get().CreateRequest()*/</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">OnResultImageByRequest</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">OnRequestCompleted</span><span class=\"params\">(FHttpRequestPtr HttpRequest, FHttpResponsePtr HttpResponse, <span class=\"type\">bool</span> bWasSuccessful)</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><code>TencentAiArt.cpp</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;TencentAiArt.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;Interfaces/IHttpResponse.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;HttpManager.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;HttpModule.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;TencentAIArtV3.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">UTencentAiArt::InitConfig</span><span class=\"params\">(<span class=\"type\">const</span> FTencentAIArtConfig&amp; AIArtConfig)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tTencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">initConfig</span>(AIArtConfig);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">UTencentAiArt::InitTTI_Or_ITI</span><span class=\"params\">(<span class=\"type\">const</span> FPromptTTIConfig&amp; PromptTTIConfig)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tTencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">initTTI_Or_ITI</span>(PromptTTIConfig);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">UTencentAiArt* <span class=\"title\">UTencentAiArt::ResultImageByRequest</span><span class=\"params\">(UObject* WorldContextObject)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">const</span> <span class=\"keyword\">auto</span> RequestObject = <span class=\"built_in\">NewObject</span>&lt;UTencentAiArt&gt;();</span><br><span class=\"line\">\tRequestObject-&gt;<span class=\"built_in\">OnResultImageByRequest</span>();</span><br><span class=\"line\">\tRequestObject-&gt;<span class=\"built_in\">RegisterWithGameInstance</span>(WorldContextObject);</span><br><span class=\"line\">\tAIArtHandler = RequestObject;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> RequestObject;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">UTexture2D* <span class=\"title\">UTencentAiArt::Base64ToTexture2D</span><span class=\"params\">(<span class=\"type\">const</span> FString&amp; Base64Str)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> UTencentConfig::<span class=\"built_in\">Base64ToTexture2D</span>(Base64Str);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">UTencentAiArt::GetRequestImageType</span><span class=\"params\">(EReqImgType&amp; ReqImgType)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tTencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">getReqImageType</span>(ReqImgType);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">UTencentAiArt::OnResultImageByRequest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">AddToRoot</span>();</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"type\">const</span> FString url = <span class=\"string\">&quot;https://&quot;</span> + <span class=\"built_in\">FString</span>(TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetHost</span>().<span class=\"built_in\">c_str</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">\tHttpRequestImage = FHttpModule::<span class=\"built_in\">Get</span>().<span class=\"built_in\">CreateRequest</span>();</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetVerb</span>(<span class=\"string\">&quot;POST&quot;</span>);</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetURL</span>(url);</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;Authorization&quot;</span>, TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetAuthorization</span>().<span class=\"built_in\">c_str</span>());</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json&quot;</span>);</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;Host&quot;</span>, TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetHost</span>().<span class=\"built_in\">c_str</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"built_in\">FString</span>(TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetAction</span>().<span class=\"built_in\">c_str</span>()) == <span class=\"string\">&quot;ImageToImage&quot;</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;X-TC-Action&quot;</span>, <span class=\"built_in\">FString</span>(<span class=\"string\">&quot;ImageToImage&quot;</span>));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;X-TC-Action&quot;</span>, <span class=\"built_in\">FString</span>(<span class=\"string\">&quot;TextToImage&quot;</span>));</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;X-TC-Timestamp&quot;</span>, TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">Gettimestamp</span>().<span class=\"built_in\">c_str</span>());</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;X-TC-Version&quot;</span>, TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetVersion</span>().<span class=\"built_in\">c_str</span>());</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetHeader</span>(<span class=\"string\">&quot;X-TC-Region&quot;</span>, TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetRegion</span>().<span class=\"built_in\">c_str</span>());</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">SetContentAsString</span>(<span class=\"built_in\">FString</span>(<span class=\"built_in\">UTF8_TO_TCHAR</span>(TencentAIArtV3::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetPayload</span>().<span class=\"built_in\">c_str</span>())));</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">OnProcessRequestComplete</span>().<span class=\"built_in\">BindUObject</span>(<span class=\"keyword\">this</span>, &amp;UTencentAiArt::OnRequestCompleted);</span><br><span class=\"line\">\tHttpRequestImage-&gt;<span class=\"built_in\">OnRequestProgress</span>().<span class=\"built_in\">BindLambda</span>([](FHttpRequestPtr HttpRequest, int32 BytesSent, int32 BytesReceived)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Is Request Process, wait&quot;</span>))</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (HttpRequestImage-&gt;<span class=\"built_in\">ProcessRequest</span>())</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt Start ======&quot;</span>));</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Request Process&quot;</span>));</span><br><span class=\"line\">\t\tFHttpModule::<span class=\"built_in\">Get</span>().<span class=\"built_in\">GetHttpManager</span>().<span class=\"built_in\">Tick</span>(<span class=\"number\">0.f</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (HttpRequestImage-&gt;<span class=\"built_in\">GetStatus</span>() == EHttpRequestStatus::Failed)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tOnFail.<span class=\"built_in\">Broadcast</span>(<span class=\"built_in\">FString</span>(<span class=\"string\">&quot;null&quot;</span>));</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Request Failed&quot;</span>));</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt End ======&quot;</span>));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">UTencentAiArt::OnRequestCompleted</span><span class=\"params\">(FHttpRequestPtr HttpRequest, FHttpResponsePtr HttpResponse, <span class=\"type\">bool</span> bWasSuccessful)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Request Completed&quot;</span>));</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (bWasSuccessful &amp;&amp; HttpResponse.<span class=\"built_in\">IsValid</span>())</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Request Successed&quot;</span>));</span><br><span class=\"line\">\t\t<span class=\"type\">const</span> FString ResponseContent = HttpResponse-&gt;<span class=\"built_in\">GetContentAsString</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Response Content = %s&quot;</span>), *ResponseContent);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 解析响应内容</span></span><br><span class=\"line\">\t\tTSharedPtr&lt;FJsonObject&gt; JsonObject;</span><br><span class=\"line\">\t\t<span class=\"type\">const</span> TSharedRef&lt;TJsonReader&lt;&gt;&gt; JsonReader = TJsonReaderFactory&lt;&gt;::<span class=\"built_in\">Create</span>(ResponseContent);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (FJsonSerializer::<span class=\"built_in\">Deserialize</span>(JsonReader, JsonObject))</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (JsonObject-&gt;<span class=\"built_in\">HasField</span>(<span class=\"string\">&quot;Response&quot;</span>))</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Get Response&quot;</span>));</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">const</span> TSharedPtr&lt;FJsonObject&gt; ResponseObject = JsonObject-&gt;<span class=\"built_in\">GetObjectField</span>(<span class=\"string\">&quot;Response&quot;</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ResponseObject-&gt;<span class=\"built_in\">HasField</span>(<span class=\"string\">&quot;ResultImage&quot;</span>))</span><br><span class=\"line\">\t\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Get ResultImage&quot;</span>));</span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">const</span> FString ImageResult = ResponseObject-&gt;<span class=\"built_in\">GetStringField</span>(<span class=\"string\">&quot;ResultImage&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tOnCompleted.<span class=\"built_in\">Broadcast</span>(ImageResult);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Result = %s&quot;</span>), *ImageResult);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt End ======&quot;</span>));</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t\tOnFail.<span class=\"built_in\">Broadcast</span>(<span class=\"built_in\">FString</span>(<span class=\"string\">&quot;null&quot;</span>));</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Request Error&quot;</span>));</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt End ======&quot;</span>));</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tOnFail.<span class=\"built_in\">Broadcast</span>(<span class=\"built_in\">FString</span>(<span class=\"string\">&quot;null&quot;</span>));</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Deserialize Error&quot;</span>));</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt End ======&quot;</span>));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tOnFail.<span class=\"built_in\">Broadcast</span>(<span class=\"built_in\">FString</span>(<span class=\"string\">&quot;null&quot;</span>));</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Deserialize Error&quot;</span>));</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt End ======&quot;</span>));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tOnFail.<span class=\"built_in\">Broadcast</span>(<span class=\"built_in\">FString</span>(<span class=\"string\">&quot;null&quot;</span>));</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Request Error&quot;</span>));</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt End ======&quot;</span>));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">RemoveFromRoot</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">UTencentAiArt::CancelRequestImage</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!AIArtHandler || !AIArtHandler-&gt;HttpRequestImage) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t<span class=\"type\">const</span> <span class=\"keyword\">auto</span> Status = AIArtHandler-&gt;HttpRequestImage-&gt;<span class=\"built_in\">GetStatus</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (Status == EHttpRequestStatus::Processing)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tAIArtHandler-&gt;HttpRequestImage-&gt;<span class=\"built_in\">CancelRequest</span>();</span><br><span class=\"line\">\t\tAIArtHandler-&gt;HttpRequestImage.<span class=\"built_in\">Reset</span>();</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Request Cancle&quot;</span>))</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogTencentAIArt, Warning, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;====== TencentAIArt End ======&quot;</span>));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n","text":"UE5腾讯AI绘画插件[toc] 0. githubUE5腾讯AI绘画插件 1. 腾讯HTTP V3验证TencentAIArtV3.h 12345678910...","permalink":"/post/7_18_UE5腾讯AI绘画插件","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"UnrealEngine","slug":"UnrealEngine","count":23,"path":"api/categories/UnrealEngine.json"},{"name":"Plugin","slug":"UnrealEngine/Plugin","count":8,"path":"api/categories/UnrealEngine/Plugin.json"}],"tags":[{"name":"UnrealEngine","slug":"UnrealEngine","count":23,"path":"api/tags/UnrealEngine.json"},{"name":"Plugin","slug":"Plugin","count":10,"path":"api/tags/Plugin.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#UE5%E8%85%BE%E8%AE%AFAI%E7%BB%98%E7%94%BB%E6%8F%92%E4%BB%B6\"><span class=\"toc-text\">UE5腾讯AI绘画插件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0-github\"><span class=\"toc-text\">0. github</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E8%85%BE%E8%AE%AFHTTP-V3%E9%AA%8C%E8%AF%81\"><span class=\"toc-text\">1. 腾讯HTTP V3验证</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-API\"><span class=\"toc-text\">2. API</span></a></li></ol></li></ol></li></ol>","author":{"name":"FangH","slug":"blog-author","avatar":"/img/fh.png","link":"/","description":"我曾惊鸿一瞥未来","socials":{"github":"https://github.com/FHangH","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/zi-heng-18-99-47","csdn":"https://blog.csdn.net/weixin_44519692?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"UE5文心一言插件","uid":"9918a2b9f61566415c27ac62b26c0656","slug":"7_19_UE5文心一言插件","date":"2024-02-29T06:19:33.432Z","updated":"2024-02-29T06:18:30.736Z","comments":true,"path":"api/articles/7_19_UE5文心一言插件.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/FHangH/FHangBlogCDN_03@master/Aurora_ (41).webp","text":"UE5文心一言插件[toc] 0. githubUE5文心一言插件 1. 结构设计WXYY.h 12345678910111213141516171819202...","permalink":"/post/7_19_UE5文心一言插件","photos":[],"count_time":{"symbolsCount":"19k","symbolsTime":"17 mins."},"categories":[{"name":"UnrealEngine","slug":"UnrealEngine","count":23,"path":"api/categories/UnrealEngine.json"},{"name":"Plugin","slug":"UnrealEngine/Plugin","count":8,"path":"api/categories/UnrealEngine/Plugin.json"}],"tags":[{"name":"UnrealEngine","slug":"UnrealEngine","count":23,"path":"api/tags/UnrealEngine.json"},{"name":"Plugin","slug":"Plugin","count":10,"path":"api/tags/Plugin.json"}],"author":{"name":"FangH","slug":"blog-author","avatar":"/img/fh.png","link":"/","description":"我曾惊鸿一瞥未来","socials":{"github":"https://github.com/FHangH","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/zi-heng-18-99-47","csdn":"https://blog.csdn.net/weixin_44519692?spm=1000.2115.3001.5343","juejin":"","customs":{}}}},"next_post":{"title":"UE5配置文件读写插件","uid":"e6dd7df07e1b0feb88d026fb6a53d946","slug":"7_17_UE5配置文件读写插件","date":"2024-02-29T06:19:33.426Z","updated":"2024-02-29T06:18:09.443Z","comments":true,"path":"api/articles/7_17_UE5配置文件读写插件.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/FHangH/FHangBlogCDN_03@master/Aurora_ (39).webp","text":"UE5配置文件读写插件[toc] 0. githubUE5配置文件读写插件 1. APIFH_FuncLib_INI.h 1234567891011121314...","permalink":"/post/7_17_UE5配置文件读写插件","photos":[],"count_time":{"symbolsCount":"8.5k","symbolsTime":"8 mins."},"categories":[{"name":"UnrealEngine","slug":"UnrealEngine","count":23,"path":"api/categories/UnrealEngine.json"},{"name":"Plugin","slug":"UnrealEngine/Plugin","count":8,"path":"api/categories/UnrealEngine/Plugin.json"}],"tags":[{"name":"UnrealEngine","slug":"UnrealEngine","count":23,"path":"api/tags/UnrealEngine.json"},{"name":"Plugin","slug":"Plugin","count":10,"path":"api/tags/Plugin.json"}],"author":{"name":"FangH","slug":"blog-author","avatar":"/img/fh.png","link":"/","description":"我曾惊鸿一瞥未来","socials":{"github":"https://github.com/FHangH","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/zi-heng-18-99-47","csdn":"https://blog.csdn.net/weixin_44519692?spm=1000.2115.3001.5343","juejin":"","customs":{}}}}}